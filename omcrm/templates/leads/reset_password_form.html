{% extends "layout.html" %}
{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center border-bottom pb-3">
                <h2 class="h3 mb-0">
                    <i class="fas fa-key text-warning me-2"></i>
                    Reset Client Password
                </h2>
                <a href="{{ url_for('leads.get_lead_view', lead_id=lead.id) }}" class="btn btn-outline-secondary">
                    <i data-feather="arrow-left" class="me-1"></i> Back to Client
                </a>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">
                        <i data-feather="user" class="me-2"></i>
                        {{ lead.first_name }} {{ lead.last_name }}
                    </h5>
                    <small class="text-muted">{{ lead.email }}</small>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning" role="alert">
                        <i data-feather="alert-triangle" class="me-2"></i>
                        <strong>Security Notice:</strong> The new password will be visible to you after reset. 
                        Please ensure the client changes it upon next login for security.
                    </div>

                    <form method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                        
                        <div class="mb-3">
                            <label for="new_password" class="form-label">
                                <i data-feather="lock" class="me-1"></i>
                                New Password
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="new_password" 
                                   name="new_password" 
                                   placeholder="Enter new password (minimum 6 characters)"
                                   minlength="6"
                                   required>
                            <div class="form-text">
                                Password must be at least 6 characters long. Consider using a secure, memorable password.
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-primary" onclick="generatePassword()">
                                    <i data-feather="shuffle" class="me-1"></i> Generate Secure Password
                                </button>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-warning">
                                <i data-feather="key" class="me-1"></i> Reset Password
                            </button>
                            <a href="{{ url_for('leads.get_lead_view', lead_id=lead.id) }}" class="btn btn-outline-secondary">
                                <i data-feather="x" class="me-1"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// üîê Generate secure password function
function generatePassword() {
    const length = 12;
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
    let password = "";
    
    // Ensure at least one character from each type
    password += "abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random() * 26)]; // lowercase
    password += "ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random() * 26)]; // uppercase
    password += "0123456789"[Math.floor(Math.random() * 10)]; // number
    password += "!@#$%^&*"[Math.floor(Math.random() * 8)]; // special
    
    // Fill the rest randomly
    for (let i = password.length; i < length; i++) {
        password += charset[Math.floor(Math.random() * charset.length)];
    }
    
    // Shuffle the password
    password = password.split('').sort(() => Math.random() - 0.5).join('');
    
    document.getElementById('new_password').value = password;
}

// Initialize feather icons
document.addEventListener('DOMContentLoaded', function() {
    feather.replace();
});
</script>
{% endblock %} 